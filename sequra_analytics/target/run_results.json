{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.9", "generated_at": "2025-08-26T16:34:18.772875Z", "invocation_id": "482fb428-f034-48db-86a9-31ae4fdadbdb", "invocation_started_at": "2025-08-26T16:34:03.118553Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:09.329921Z", "completed_at": "2025-08-26T16:34:09.336229Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:09.337155Z", "completed_at": "2025-08-26T16:34:11.963278Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 2.721547842025757, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-66de-0000-000167def1dd"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.stg_orders", "compiled": true, "compiled_code": "\n\nwith source_data as (\n    select\n        order_id,\n        shopper_id,\n        merchant_id,\n        order_date as order_date_raw,\n        -- Parse the date format (d/m/yy or dd/mm/yy)\n        case \n            when split_part(order_date, '/', 3) = '22' then '2022'\n            when split_part(order_date, '/', 3) = '23' then '2023'\n            else '20' || split_part(order_date, '/', 3)\n        end || '-' ||\n        lpad(split_part(order_date, '/', 2), 2, '0') || '-' ||\n        lpad(split_part(order_date, '/', 1), 2, '0') as order_date_formatted\n    from SEQURA_DEV.dbt_maximerosa_raw_data.orders_merchant\n)\n\nselect\n    order_id,\n    shopper_id,\n    merchant_id,\n    order_date_raw,\n    to_date(order_date_formatted, 'YYYY-MM-DD') as order_date,\n    date_trunc('month', to_date(order_date_formatted, 'YYYY-MM-DD')) as order_month,\n    to_char(to_date(order_date_formatted, 'YYYY-MM-DD'), 'YYYY-MM') as month_year\nfrom source_data\nwhere order_date_raw is not null", "relation_name": "SEQURA_DEV.dbt_maximerosa_staging.stg_orders", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:09.320331Z", "completed_at": "2025-08-26T16:34:09.336758Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:09.350869Z", "completed_at": "2025-08-26T16:34:11.964973Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 2.7424509525299072, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-670a-0001-67de00011016"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.stg_merchants", "compiled": true, "compiled_code": "\n\nselect\n    merchant_id,\n    merchant_name\nfrom SEQURA_DEV.dbt_maximerosa_raw_data.merchants", "relation_name": "SEQURA_DEV.dbt_maximerosa_staging.stg_merchants", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:12.072392Z", "completed_at": "2025-08-26T16:34:12.078368Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:12.091154Z", "completed_at": "2025-08-26T16:34:14.705361Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 2.7157199382781982, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-670a-0001-67de0001101a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.int_orders_with_defaults", "compiled": true, "compiled_code": "\n\n-- Placeholder for Part 2 of the challenge\n-- This would contain the logic for calculating default ratios\n-- when the additional data tables are available\n\nwith orders_base as (\n    select\n        o.*,\n        m.merchant_name,\n        -- Placeholder fields for default calculation\n        -- These would come from the actual orders table with financial data\n        null::boolean as is_in_default,\n        null::integer as days_unbalanced,\n        null::decimal(15,2) as current_order_value,\n        null::decimal(15,2) as overdue_amount,\n        null::varchar as product,\n        null::integer as shopper_age\n    from SEQURA_DEV.dbt_maximerosa_staging.stg_orders o\n    left join SEQURA_DEV.dbt_maximerosa_staging.stg_merchants m\n        on o.merchant_id = m.merchant_id\n)\n\nselect\n    *,\n    case\n        when days_unbalanced > 90 then '90+'\n        when days_unbalanced > 60 then '60'\n        when days_unbalanced > 30 then '30'\n        when days_unbalanced > 17 then '17'\n        else null\n    end as delayed_period\nfrom orders_base", "relation_name": "SEQURA_DEV.dbt_maximerosa_intermediate.int_orders_with_defaults", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:12.052632Z", "completed_at": "2025-08-26T16:34:12.057046Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:12.057680Z", "completed_at": "2025-08-26T16:34:14.697923Z"}], "thread_id": "Thread-10 (worker)", "execution_time": 2.7386069297790527, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-66de-0000-000167def1e9"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.int_recurrent_shoppers", "compiled": true, "compiled_code": "\n\nwith order_history as (\n    select\n        o1.order_month as current_month,\n        o1.month_year as current_month_year,\n        o1.merchant_id,\n        o1.shopper_id,\n        count(distinct o2.order_month) as months_with_purchases\n    from SEQURA_DEV.dbt_maximerosa_staging.stg_orders o1\n    left join SEQURA_DEV.dbt_maximerosa_staging.stg_orders o2\n        on o1.merchant_id = o2.merchant_id\n        and o1.shopper_id = o2.shopper_id\n        and o2.order_date between dateadd(month, -11, o1.order_month) and last_day(o1.order_month)\n        and o2.order_month <= o1.order_month\n    group by 1, 2, 3, 4\n)\n\nselect\n    current_month,\n    current_month_year,\n    merchant_id,\n    shopper_id,\n    months_with_purchases,\n    -- A shopper is recurrent if they have made purchases in at least 2 different months\n    -- within the 12-month window including the current month\n    case \n        when months_with_purchases >= 2 then 1 \n        else 0 \n    end as is_recurrent\nfrom order_history", "relation_name": "SEQURA_DEV.dbt_maximerosa_intermediate.int_recurrent_shoppers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:12.047704Z", "completed_at": "2025-08-26T16:34:12.060752Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:12.061562Z", "completed_at": "2025-08-26T16:34:14.700555Z"}], "thread_id": "Thread-11 (worker)", "execution_time": 2.739727020263672, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-66de-0000-000167def1e5"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.int_monthly_shoppers", "compiled": true, "compiled_code": "\n\nwith monthly_orders as (\n    select distinct\n        order_month,\n        month_year,\n        merchant_id,\n        shopper_id\n    from SEQURA_DEV.dbt_maximerosa_staging.stg_orders\n)\n\nselect\n    order_month,\n    month_year,\n    merchant_id,\n    shopper_id,\n    -- Flag if this shopper made a purchase with this merchant in the current month\n    1 as made_purchase_current_month\nfrom monthly_orders", "relation_name": "SEQURA_DEV.dbt_maximerosa_intermediate.int_monthly_shoppers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:12.069717Z", "completed_at": "2025-08-26T16:34:12.076847Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:12.078655Z", "completed_at": "2025-08-26T16:34:15.411891Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 3.4103782176971436, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-66de-0000-000167def1e1"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.default_ratio_analysis", "compiled": true, "compiled_code": "\n\n-- This model calculates the default ratio as requested in Part 2\n\nwith orders_with_defaults as (\n    -- This would come from the actual orders table with financial data\n    select\n        o.*,\n        m.merchant_name as merchant,\n        -- These fields would come from the actual source data:\n        null::integer as shopper_age,\n        null::varchar as product,\n        null::boolean as is_in_default,\n        null::integer as days_unbalanced,\n        null::decimal(15,2) as current_order_value,\n        null::decimal(15,2) as overdue_amount\n    from SEQURA_DEV.dbt_maximerosa_staging.stg_orders o\n    left join SEQURA_DEV.dbt_maximerosa_staging.stg_merchants m\n        on o.merchant_id = m.merchant_id\n),\n\n-- Calculate delayed periods based on days_unbalanced\n-- An order with 35 days unbalanced is included in both 17 and 30 day calculations\ndelayed_period_17 as (\n    select\n        shopper_age,\n        month_year as month_year_order,\n        product,\n        merchant,\n        'in_default' as default_type,\n        '17' as delayed_period\n    from orders_with_defaults\n    where days_unbalanced > 17\n        and is_in_default = true\n),\n\ndelayed_period_30 as (\n    select\n        shopper_age,\n        month_year as month_year_order,\n        product,\n        merchant,\n        'in_default' as default_type,\n        '30' as delayed_period\n    from orders_with_defaults\n    where days_unbalanced > 30\n        and is_in_default = true\n),\n\ndelayed_period_60 as (\n    select\n        shopper_age,\n        month_year as month_year_order,\n        product,\n        merchant,\n        'in_default' as default_type,\n        '60' as delayed_period\n    from orders_with_defaults\n    where days_unbalanced > 60\n        and is_in_default = true\n),\n\ndelayed_period_90 as (\n    select\n        shopper_age,\n        month_year as month_year_order,\n        product,\n        merchant,\n        'in_default' as default_type,\n        '90' as delayed_period\n    from orders_with_defaults\n    where days_unbalanced > 90\n        and is_in_default = true\n),\n\n-- Union all delayed periods\nall_defaults as (\n    select * from delayed_period_17\n    union all\n    select * from delayed_period_30\n    union all\n    select * from delayed_period_60\n    union all\n    select * from delayed_period_90\n)\n\n-- Final output with the exact columns requested\nselect\n    shopper_age,\n    month_year_order,\n    product,\n    merchant,\n    default_type,\n    delayed_period\nfrom all_defaults\norder by \n    month_year_order,\n    merchant,\n    delayed_period::integer", "relation_name": "SEQURA_DEV.dbt_maximerosa_marts.default_ratio_analysis", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-26T16:34:14.791050Z", "completed_at": "2025-08-26T16:34:14.796221Z"}, {"name": "execute", "started_at": "2025-08-26T16:34:14.796872Z", "completed_at": "2025-08-26T16:34:18.690642Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 3.977142095565796, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bea1a2-0001-670a-0001-67de0001101e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.sequra_analytics.shopper_recurrence_rate", "compiled": true, "compiled_code": "\n\nwith monthly_metrics as (\n    select\n        ms.order_month,\n        ms.month_year,\n        ms.merchant_id,\n        m.merchant_name,\n        count(distinct ms.shopper_id) as total_shoppers,\n        sum(rs.is_recurrent) as recurrent_shoppers\n    from SEQURA_DEV.dbt_maximerosa_intermediate.int_monthly_shoppers ms\n    left join SEQURA_DEV.dbt_maximerosa_intermediate.int_recurrent_shoppers rs\n        on ms.order_month = rs.current_month\n        and ms.merchant_id = rs.merchant_id\n        and ms.shopper_id = rs.shopper_id\n    left join SEQURA_DEV.dbt_maximerosa_staging.stg_merchants m\n        on ms.merchant_id = m.merchant_id\n    group by 1, 2, 3, 4\n)\n\nselect\n    merchant_name,\n    month_year as month,\n    round(\n        case \n            when total_shoppers > 0 \n            then (recurrent_shoppers::decimal / total_shoppers) * 100\n            else 0 \n        end, 2\n    ) as recurrence_rate\nfrom monthly_metrics\norder by merchant_name, month", "relation_name": "SEQURA_DEV.dbt_maximerosa_marts.shopper_recurrence_rate", "batch_results": null}], "elapsed_time": 14.941823959350586, "args": {"profiles_dir": "/Users/maximerosa/Downloads/SeQura-Test-Analytics-Engineer/sequra_analytics", "introspect": true, "log_level": "info", "log_format": "default", "show_all_deprecations": false, "source_freshness_run_project_hooks": true, "cache_selected_only": false, "require_generic_test_arguments_property": true, "log_file_max_bytes": 10485760, "skip_nodes_if_on_run_start_fails": false, "partial_parse_file_diff": true, "use_colors_file": true, "select": [], "require_explicit_package_overrides_for_builtin_materializations": true, "printer_width": 80, "project_dir": "/Users/maximerosa/Downloads/SeQura-Test-Analytics-Engineer/sequra_analytics", "log_format_file": "debug", "indirect_selection": "eager", "log_level_file": "debug", "print": true, "require_yaml_configuration_for_mf_time_spines": false, "vars": {}, "send_anonymous_usage_stats": true, "populate_cache": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "favor_state": false, "log_path": "/Users/maximerosa/Downloads/SeQura-Test-Analytics-Engineer/sequra_analytics/logs", "use_fast_test_edges": false, "upload_to_artifacts_ingest_api": false, "validate_macro_args": false, "require_batched_execution_for_custom_microbatch_strategy": false, "version_check": true, "defer": false, "partial_parse": true, "which": "run", "state_modified_compare_vars": false, "macro_debugging": false, "static_parser": true, "require_resource_names_without_spaces": true, "exclude": [], "empty": false, "quiet": false, "state_modified_compare_more_unrendered_values": false, "strict_mode": false, "use_colors": true, "require_all_warnings_handled_by_warn_error": false, "write_json": true, "show_resource_report": false, "invocation_command": "dbt run", "require_nested_cumulative_type_params": false}}